import{r as d,t as v,s as w,R as u,l as g,j as h,F as S}from"./index-b4b9f8f0.js";function M(){const[c,p]=d.useState([]),[_,n]=d.useState(!1),{selectors:{iuaReducer:{iuaRelations:o,iuaSockets:f}},actions:{setProcessChainId:a=a}}=v({}),{selectors:{messagesReducer:{is_connected:i=i}}}=w();d.useEffect(()=>{const t=[];c.forEach(s=>{Object.keys(o).includes(s)?t.push(s):window.mapps_socket.emit("leave-iua",{iua_id:s})}),Object.keys(o).map(s=>{c.includes(s)||window.mapps_socket.emit("join-iua",{iua_id:s}),t.push(s)}),p(t)},[o]),d.useEffect(()=>(i&&_==!1&&(n(!0),window.mapps_socket.on("iua_status",function(t){}),window.mapps_socket.on("iua_process_chain",function(t){try{a(t.iua_id,t.process_chain_id)}catch(s){console.log(s)}}),window.mapps_socket.on("iua_joined",function(t){})),()=>{window.mapps_socket&&(window.mapps_socket.off("iua_joined"),window.mapps_socket.off("iua_process_chain"),window.mapps_socket.off("iua_status"))}),[i])}const j=()=>{M();const[c,p]=u.useState(!1),[_]=u.useState([]),{selectors:{messagesReducer:{is_connected:n=n}},actions:o=o}=w(),{selectors:{authReducer:{user:f=f}}}=g();return u.useEffect(()=>{if(n==!0&&c==!1){p(!0);let a=o.newMessage,i=o.unreadMessages,t=o.readMsg,s=f.id,l=o.setAsReadMsg,m=o.addConv;window.mapps_socket.on("msg-saved",function(){}),window.mapps_socket.on("invite",function(e){window.mapps_socket.emit("join-room",{conversation_id:e.conversation_id}),_.find(r=>r==e.conversation_id)||window.mapps_socket.emit("join-room",{conversation_id:e.conversation_id}),e.conversation&&m({conversation:e.conversation})}),window.mapps_socket.onAny((e,...r)=>{console.log(e,r)}),window.mapps_socket.on("new_msg",function(e){a(e),e.users.filter(k=>k.user_id==s).length>0&&i([e])}),window.mapps_socket.on("msg_read",function(e){e.user_id==s?t(e):l(e)}),window.mapps_socket.on("message-room",function(e){a(e)})}},[n]),h(S,{})},R=u.memo(j);export{R as default};
