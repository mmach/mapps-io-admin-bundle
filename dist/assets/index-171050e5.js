import{L as K,N as $,a as P,O as R,bG as H,$ as X,i as J,a0 as ee,R as s,m as te,M as C,U as F,l as j,G as c,j as t,X as E,Y as U,a1 as ne,a2 as se,a3 as O,W as G,V as Q,Z as W}from"./index-7700e132.js";import{d as re}from"./Extension-604c0d67.js";import{d as oe}from"./Close-6d173d88.js";import{S as ae}from"./style-92bd7e2c.js";import{d as ie}from"./LockOpen-41301f26.js";import{I as z}from"./IconButton-5a6d90cd.js";import"./createSvgIcon-38199d6a.js";const ue=({type:e})=>({columns:[{titleToken:"CREATED AT",field:"createdAt",type:"date",isActive:!0},{titleToken:"TOKEN",field:"token",isActive:!0},{titleToken:"IS LAZY",field:"load_on_init",isActive:!0,type:"!checkbox"},{titleToken:"ACTIVE",field:"is_active",isActive:!0,type:"checkbox"}],enableMultiRowSelection:!1,enableRowSelection:!0}),S=e=>{const r={getCmsMenuAdmin:()=>e(new R().queryThunt("getCmsMenusAdminQuery",{})),getProjectCmsMenuElement:()=>e(new R().queryThunt("getCmsMenusQuery",{})),setCurrentMenuId:n=>e({type:H.SET_CURRENT_MENU,dto:n}),clean:n=>e({type:H.CLEAN_MENU_STORAGE}),upsertProjectCmsMenu:n=>e(new R().commandThunt("upsertProjectCmsMenuCommand",n)),deleteProjectCmsMenuItem:n=>e(new R().commandThunt("deleteProjectCmsMenuItemCommand",n)),upsertCmsMenuItem:n=>e(new R().commandThunt("upsertProjectCmsMenuItemCommand",n)),upsertProjectCmsMenuItemPrivilegeCommand:n=>e(new R().commandThunt("upsertProjectCmsMenuItemPrivilegeCommand",n)),deleteProjectCmsMenuItemPrivilegeCommand:n=>e(new R().commandThunt("deleteProjectCmsMenuItemPrivilegeCommand",n)),deleteProjectCmsMenu:n=>e(new R().commandThunt("deleteProjectCmsMenuCommand",n))};return{...r,upsertCmsMenuItem:async n=>{await r.upsertCmsMenuItem(n),await r.getCmsMenuAdmin()},upsertProjectCmsMenu:async n=>{await r.upsertProjectCmsMenu(n),await r.getCmsMenuAdmin()},deleteProjectCmsMenu:async n=>{await r.deleteProjectCmsMenu(n),await r.getCmsMenuAdmin()},upsertBunchCmsMenuItem:async n=>{const _=n.map(v=>r.upsertCmsMenuItem(v));await Promise.all(_),await r.getCmsMenuAdmin()},upsertProjectCmsMenuItemPrivilegeCommand:async n=>{await r.upsertProjectCmsMenuItemPrivilegeCommand(n),await r.getCmsMenuAdmin()},deleteProjectCmsMenuItem:async n=>{await r.deleteProjectCmsMenuItem(n),await r.getCmsMenuAdmin()},deleteProjectCmsMenuItemPrivilegeCommand:async n=>{await r.deleteProjectCmsMenuItemPrivilegeCommand(n),await r.getCmsMenuAdmin()}}},le=e=>e.CmsMenuAdminReducer.current_menu_id?e.CmsMenuAdminReducer.cms.find(r=>r.id==e.CmsMenuAdminReducer.current_menu_id):null,ce=e=>r=>e?r.CmsMenuAdminReducer.cms.find(n=>n.id==r.CmsMenuAdminReducer.current_menu_id).menu_items.find(n=>n.id==e):null,me=e=>r=>e?r.CmsMenuAdminReducer.cms.find(n=>n.id==e):null;function V(){const e=K(),{cmsMenuAdminReducer:r}=$(o=>({cmsMenuAdminReducer:o.CmsMenuAdminReducer})),[n,_]=P.useState(),[v,b]=P.useState(),f=$(le),p=$(ce(n)),M=$(me(v)),u=P.useCallback(S(e).getCmsMenuAdmin,[e]),a=P.useCallback(S(e).deleteProjectCmsMenu,[e]),i=P.useCallback(S(e).getProjectCmsMenuElement,[e]),l=P.useCallback(S(e).setCurrentMenuId,[e]),w=P.useCallback(S(e).upsertCmsMenuItem,[e]),x=P.useCallback(S(e).upsertBunchCmsMenuItem,[e]),T=P.useCallback(S(e).deleteProjectCmsMenuItem,[e]),D=P.useCallback(S(e).upsertProjectCmsMenuItemPrivilegeCommand,[e]),h=P.useCallback(S(e).deleteProjectCmsMenuItemPrivilegeCommand,[e]),k=P.useCallback(S(e).upsertProjectCmsMenu,[e]),B=P.useCallback(S(e).clean,[e]);return{selectors:{cmsMenuAdminReducer:r,getCurrentCmsMenuReducer:f,getCmsMenuItemReducer:p,getCmsMenuReducer:M},actions:{getCmsMenuAdmin:u,getProjectCmsMenuElement:i,setCurrentMenuId:l,upsertCmsMenuItem:w,upsertBunchCmsMenuItem:x,upsertProjectCmsMenu:k,deleteProjectCmsMenu:a,deleteProjectCmsMenuItem:T,upsertProjectCmsMenuItemPrivilegeCommand:D,deleteProjectCmsMenuItemPrivilegeCommand:h,clean:B},state:{cmsMenuId:v,cmsMenuItemId:n},hooks:{setCmsMenuId:b,setCmsMenuItemId:_},functions:{}}}var q={},de=J,Ce=ee;Object.defineProperty(q,"__esModule",{value:!0});var Y=q.default=void 0,pe=Ce(P),Me=de(X()),ge=(0,Me.default)(pe.createElement("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");Y=q.default=ge;function fe({cmsMenuItem:e,setCmsMenuItem:r}){const n=s.useMemo(()=>te.byName("mapps-component-translate-component").component,[]),_=s.useMemo(C().Layouts.Groups.V1),v=s.useMemo(C().FormComponents.TextBox),b=s.useMemo(C().FormComponents.Checkbox),{getPlaceholder:f,getLabel:p,translate:M}=F(),[u,a]=s.useState({...e});s.useEffect(()=>{r(u)},[u]);function i(l){u.translation_id||(u.translation_id=E()),l.id||(l.id=u.translation_id),a({...u,translation:l})}return j(c,{container:!0,children:[t(c,{item:!0,xs:6,style:{display:"flex"},children:j(_,{title:"Menu Item Details",children:[t(v,{onChange:l=>{a({...u,url:l.target.value})},placeholder:M(f,"Url"),label:M(p,"Url"),value:u.url,field:"url",validation:[]}),t(v,{onChange:l=>{a({...u,icon:l.target.value})},placeholder:M(f,"Icon"),label:M(p,"Icon"),value:u.icon,field:"icon",validation:[]}),t(v,{onChange:l=>{a({...u,plugin_name:l.target.value})},placeholder:M(f,"Plugin Name"),label:M(p,"Plugin Name"),value:u.plugin_name,field:"plugin_name",validation:[]}),t(b,{label:M(p,"Active"),value:u.is_active,onChange:l=>{a({...u,is_active:l.target.checked})}})]})}),t(c,{item:!0,xs:6,style:{display:"flex"},children:t(_,{title:"Menu Item Translation",children:t(n,{translation:u.translation||{},setTranslate:i,i:!0})})})]})}function he({cmsMenuItemId:e,cmsMenuParentId:r}){const n=s.useMemo(C().ButtonLoader),_=U(),{translate:v,getLabel:b}=F(),[f,p]=s.useState(!0),[M,u]=s.useState({}),{selectors:{getCmsMenuItemReducer:a,getCurrentCmsMenuReducer:i},actions:{upsertCmsMenuItem:l},hooks:{setCmsMenuItemId:w}}=V();s.useEffect(()=>{e?w(e):(u({id:E(),sort_order:0}),p(!1))},[]),s.useEffect(()=>{a&&(u(a),p(!1))},[a]);async function x(){i&&(await l({...M,cms_menu_id:i.id,cms_menu_item_parent_id:r}),_.actions.closeDrawer())}return!f&&j(c,{container:!0,children:[t(fe,{cmsMenuItem:{...M},setCmsMenuItem:u}),t(c,{style:{marginLeft:"1rem",marginBottom:"1rem"},children:t(n,{color:"primary",onClick:x,value:v(b,"Save"),variant:"outlined"})})]})}const ve=["!","|","&","="];function _e({cmsMenuItemId:e}){const r=s.useMemo(C().Layouts.Groups.V1),n=s.useMemo(C().BodyLoader),_=s.useMemo(C().ButtonLoader),v=s.useMemo(C().FormComponents.DropDownList),b=s.useMemo(C().FormComponents.TextBox),f=s.useMemo(C().FormComponents.TagComponent);U();const{translate:p,getLabel:M}=F(),[u,a]=s.useState(!0),[i,l]=s.useState({}),{selectors:{privsSelector:w}}=ne(),{selectors:{getCmsMenuItemReducer:x,getCurrentCmsMenuReducer:T},actions:{upsertCmsMenuItem:D,upsertProjectCmsMenuItemPrivilegeCommand:h,deleteProjectCmsMenuItemPrivilegeCommand:k},hooks:{setCmsMenuItemId:B}}=V();s.useEffect(()=>{e&&B(e)},[]),s.useEffect(()=>{x&&(l(x),a(!1))},[x]);function o(){const m=[],A=w.filter(y=>!m.includes(y.id));return[{id:"",value:""},...A].map(y=>({id:y.id,value:y.privilege||y.value}))}function d(m){const A=m.currentTarget.dataset.key;a(!0),k({id:A}).then(y=>{a(!1)})}function g(m){a(!0),h({id:E(),status:1,privilege_id:m.target.value,cms_menu_item_id:e}).then(A=>{a(!1)})}function L(m,A){if(m.split(" ").filter(y=>!y.startsWith("#")).length+1!=m.split(" ").filter(y=>y.startsWith("#")).length)return!1;{const y=m.split(" ").filter(N=>N.startsWith("#$")).map(N=>N.replace(/#/g,"").replace("$",""));return y.filter(N=>A.map(Z=>Z.privileges.privilege_details.name.trim()).includes(N)).length==y.length}}function I(){a(!0),D(i).then(m=>{a(!1)})}try{return i&&!u?j(c,{container:!0,style:{display:"flex"},children:[t(r,{title:"Menu Item Details",children:t(b,{disabled:!0,label:p(M,"Url"),value:i.url,field:"value",validation:[]})}),j(r,{title:"Allowed Privileges",children:[t(v,{label:"Privileges",valueOptions:o(),value:"",onChange:g,field:"type",validation:[]}),i.menu_item_privileges.map((m,A)=>t(se,{"data-key":m.id,onClick:d,label:m.privileges.privilege_details.name.trim()},m.id))]}),j(r,{title:"Function",style:{display:"flex",width:"100%"},children:[t(c,{xs:12,children:t(f,{notUniq:!0,disabled:!0,tags:i.func?i.func.split(" ").map(m=>({id:E(),value:E(),label:m})):[],noLabel:!0,onChange:m=>{const A=m.map(y=>y.label).join(" ");l({...i,func:A})},suggestions:[...ve.map(m=>({value:m,label:m,type:"OPERATOR"})),,...i.menu_item_privileges.map(m=>({id:E(),value:E(),label:`#$${m.privileges.privilege_details.name.trim()}#`,type:"PRIV"}))]})}),t(c,{xs:12,style:{marginLeft:"1rem",marginBottom:"1rem",marginTop:"1rem"},children:i.func?t(c,{style:{color:L(i.func,i.menu_item_privileges)?"green":"red"},children:i.func}):t(O,{})}),t(c,{xs:12,style:{marginLeft:"1rem",marginBottom:"1rem",marginTop:"1rem"},children:t(_,{color:"primary",onClick:I,value:p(M,"Save Func"),variant:"outlined"})})]})]}):t(c,{style:{height:"400px",display:"flex",width:"100%"},children:t(n,{text:" ",size:"25px"})})}catch(m){return console.log(m),t(O,{})}}function ye({node:e}){const r=s.useMemo(C().ButtonLoader);return e?t(O,{children:t(r,{className:e.isActive==!0?"selected":"",variant:"clean",size:"small",value:t(c,{style:{display:"flex",flexDirection:"column"},children:t(c,{children:String(e.translation?e.translation.name:e.url).toUpperCase()})}),startIcon:e.icon?G[e.icon]?G[e.icon].render():t("img",{style:{maxWidth:20,maxHeight:20,width:20},src:window.env.BLOB_URL+"/blob/"+e.icon},e.id):t(c,{style:{maxWidth:20,maxHeight:20,width:20}})},e.id)}):t(O,{})}function Ie(){const e=s.useMemo(C().ConfirmationDialog),[r,n]=s.useState([{title:"_ROOT",category:"_ROOT",children:[{title:"index.js",category:" "}]}]);s.useState(""),s.useState(!0),s.useMemo(C().Layouts.Table.V2);const _=s.useMemo(C().Layouts.Sections.V1),v=s.useMemo(C().Layouts.Groups.V1),b=s.useMemo(C().ButtonLoader),{actions:f}=U(),p=Q(),{translate:M,getLabel:u}=F(),{selectors:{getCurrentCmsMenuReducer:a},actions:{getCmsMenuAdmin:i,upsertCmsMenuItem:l,upsertBunchCmsMenuItem:w,deleteProjectCmsMenuItem:x}}=V();s.useEffect(()=>{window.__isReactDndBackendSetUp&&(window.__isReactDndBackendSetUp=!1)},[]),s.useEffect(()=>{a&&T()},[a]);function T(){const o=a.menu_items.sort((g,L)=>g.sort_order>L.sort_order?1:-1).map(g=>({...g,treeIndex:g.sort_order,expanded:!0})),d=D([...o.map(g=>({...g}))]);n([...d.map(g=>({...g}))])}function D(o){const d={};let g;const L=[];let I;for(I=0;I<o.length;I+=1)d[o[I].id]=I,o[I].children=[];for(I=0;I<o.length;I+=1)try{g=o[I],g.cms_menu_item_parent_id!==null?o[d[g.cms_menu_item_parent_id]].children.push(g):L.push(g)}catch{}return L}function h(o,d,g){f.openDrawer(!0,t(c,{style:{width:"50vw",display:"flex"},children:t(he,{cmsMenuParentId:d,cmsMenuItemId:g})}),"right")}function k(o,d){f.openDrawer(!0,t(c,{style:{width:"50vw",display:"flex"},children:t(_e,{cmsMenuItemId:d})}),"right")}function B(o,d){p.actions.openDialog(!0,t(e,{title:"Delete Menu Item",description:"Do you want to delete asdasdasd menu item?",onConfirm:async()=>{p.actions.closeDialog(),await x({id:d})}}))}return a?j(_,{title:a.token,children:[t(c,{children:t(b,{color:"primary",onClick:h,value:M(u,"Create"),startIcon:t(W,{}),variant:"outlined"})}),t(v,{title:"Category Tree",children:t(c,{style:{display:"block",width:"100%",height:"100%"},children:t(ae,{rowHeight:55,style:{height:"800px"},treeData:r,onChange:o=>{n([...o])},canDrag:o=>!0,onMoveNode:async o=>{let d=[];return o.nextParentNode?d=o.nextParentNode.children.map((L,I)=>({...L,sort_order:I,title:void 0,children:[],cms_menu_item_parent_id:o.nextParentNode.id})):d=o.treeData.map((g,L)=>({...g,sort_order:L,children:[],title:void 0,cms_menu_item_parent_id:null})),await w(d),o},generateNodeProps:o=>(o.node.title=t(c,{style:{paddingLeft:20},children:t(ye,{node:{...o.node}})}),o.buttons=[],o.buttons.push(t(z,{size:"small",onClick:d=>h(d,o.node.id),children:t(W,{})})),o.buttons.push(t(z,{size:"small",onClick:d=>h(d,o.node.cms_menu_item_parent_id,o.node.id),children:t(Y,{})})),o.buttons.push(t(z,{size:"small",onClick:d=>B(d,o.node.id),children:t(oe,{})})),o.buttons.push(t(z,{size:"small",onClick:d=>k(d,o.node.id),children:t(ie,{})})),o),onlyExpandSearchedNodes:!0})})})]}):t(O,{})}function Pe({cmsMenuId:e}){const r=s.useMemo(C().Layouts.Groups.V1),n=s.useMemo(C().FormComponents.TextBox),_=s.useMemo(C().FormComponents.Checkbox),v=s.useMemo(C().ButtonLoader),b=U(),{translate:f,getLabel:p,getPlaceholder:M}=F(),[u,a]=s.useState(!0),[i,l]=s.useState({}),{selectors:{getCmsMenuReducer:w},actions:{upsertProjectCmsMenu:x},hooks:{setCmsMenuId:T}}=V();s.useEffect(()=>{e?T(e):(l({id:E(),sort_order:0}),a(!1))},[]),s.useEffect(()=>{w&&(l(w),a(!1))},[w]);async function D(){await x({...i}),b.actions.closeDrawer()}return!u&&j(c,{container:!0,children:[t(c,{item:!0,xs:12,style:{display:"flex"},children:j(r,{title:"Menu Details",children:[t(n,{onChange:h=>{l({...i,token:h.target.value})},placeholder:f(M,"Menu token"),label:f(p,"Menu token"),value:i.token,field:"menu-token",validation:[]}),t(_,{label:f(p,"Load on init"),value:i.load_on_init,onChange:h=>{l({...i,load_on_init:h.target.checked})}}),t(_,{label:f(p,"Active"),value:i.is_active,onChange:h=>{l({...i,is_active:h.target.checked})}})]})}),t(c,{style:{marginLeft:"1rem",marginBottom:"1rem"},children:t(v,{color:"primary",onClick:D,value:f(p,"Save"),variant:"outlined"})})]})}function De(){const e=s.useMemo(C().ConfirmationDialog),[r,n]=s.useState(!0),_=s.useMemo(C().Layouts.Table.V2),v=s.useMemo(C().Layouts.Containers.V1),b=s.useMemo(C().ButtonLoader),{actions:f}=U(),p=Q(),{translate:M,getLabel:u}=F(),{selectors:{cmsMenuAdminReducer:a},actions:{getCmsMenuAdmin:i,setCurrentMenuId:l,deleteProjectCmsMenu:w,clean:x}}=V();s.useEffect(()=>(n(!0),Promise.all([i()]).then(h=>{n(!1)}),x),[]);function T(h,k){f.openDrawer(!0,t(c,{style:{width:"50vw",display:"flex"},children:t(Pe,{cmsMenuId:k&&k.id})}),"right")}function D(h,k){p.actions.openDialog(!0,t(e,{title:"Delete CMS Menu",description:`Do you want to delete ${k.token} menu?`,onConfirm:async()=>{p.actions.closeDialog(),n(!0),await w(k),n(!1)}}))}return t(c,{container:!0,style:{justifyContent:"center"},children:t(v,{title:"CMS Menus",icon:t(re,{}),xs:12,sm:12,children:j(c,{container:!0,style:{justifyContent:"center"},children:[t(c,{item:!0,xs:6,children:t(_,{freeActions:[t(b,{size:"small",value:M(u,"Create"),variant:"outlined",onClick:T,startIcon:t(W,{})},1)],onRowSelectionChange:h=>{const k=Object.keys(h).map(B=>B);l(k[0])},isLoading:r,title:"Manage CMS Menus",actions:[h=>({icon:G.Edit,label:"Edit",onClick:T}),h=>({icon:G.Delete,label:"Delete",onClick:D})],pageSize:20,...ue({}),data:a.cms||[]})}),t(c,{item:!0,container:!0,xs:6,children:t(Ie,{})})]})})})}export{De as default};
