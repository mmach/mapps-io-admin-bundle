import{r as a,t as f,s as _,R as d,l as w,j as m,F as k}from"./index-96500733.js";function l(){const[i,r]=a.useState([]),[u,c]=a.useState(!1),{selectors:{iuaReducer:{iuaRelations:t,iuaSockets:p}},actions:{setProcessChainId:n=n}}=f({}),{selectors:{messagesReducer:{is_connected:e=e}}}=_();a.useEffect(()=>{const s=[];i.forEach(o=>{Object.keys(t).includes(o)?s.push(o):window.mapps_socket.emit("leave-iua",{iua_id:o})}),Object.keys(t).map(o=>{i.includes(o)||window.mapps_socket.emit("join-iua",{iua_id:o}),s.push(o)}),r(s)},[t]),a.useEffect(()=>(e&&u==!1&&(c(!0),window.mapps_socket.on("iua_status",function(s){}),window.mapps_socket.on("iua_process_chain",function(s){try{n(s.iua_id,s.process_chain_id)}catch(o){console.log(o)}}),window.mapps_socket.on("iua_joined",function(s){})),()=>{window.mapps_socket&&(window.mapps_socket.off("iua_joined"),window.mapps_socket.off("iua_process_chain"),window.mapps_socket.off("iua_status"))}),[e])}const v=()=>{l();const[i,r]=d.useState(!1),[u]=d.useState([]),{selectors:{messagesReducer:{is_connected:c}},actions:t}=_(),{selectors:{authReducer:{user:p}}}=w();return a.useEffect(()=>{if(c==!0&&i==!1){r(!0);let n=p.id;window.mapps_socket.on("msg-saved",function(){}),window.mapps_socket.on("invite",function(e){window.mapps_socket.emit("join-room",{conversation_id:e.conversation_id}),u.find(s=>s==e.conversation_id)||window.mapps_socket.emit("join-room",{conversation_id:e.conversation_id}),e.conversation&&t.addConv({conversation:e.conversation})}),window.mapps_socket.onAny((e,...s)=>{console.log(e,s)}),window.mapps_socket.on("new_msg",function(e){t.newMessage({...e,currentUserId:n}),e.users.filter(o=>o.user_id==n).length>0&&t.unreadMessages([e])}),window.mapps_socket.on("msg_read",function(e){e.user_id==n?t.readMsg(e):t.setAsReadMsg(e)}),window.mapps_socket.on("message-room",function(e){t.newMessage({...e,currentUserId:n})})}},[c]),m(k,{})},S=d.memo(v);export{S as default};
