import{cZ as Z,c_ as $,r as k,c$ as R,ev as W,R as s,m as K,M as p,u as F,g as T,G as c,j as e,v as E,y as U,d7 as Y,d8 as J,F as O,T as G,d2 as q,d5 as H,dj as z,ew as X,q as ee,ej as te,eu as ne}from"./index-96500733.js";import{S as se}from"./style-f1ff7dc4.js";import"./toConsumableArray-b40f290f.js";const oe=({type:t})=>({columns:[{titleToken:"CREATED AT",field:"createdAt",type:"date",isActive:!0},{titleToken:"TOKEN",field:"token",isActive:!0},{titleToken:"IS LAZY",field:"load_on_init",isActive:!0,type:"!checkbox"},{titleToken:"ACTIVE",field:"is_active",isActive:!0,type:"checkbox"}],enableMultiRowSelection:!1,enableRowSelection:!0}),S=t=>{const o={getCmsMenuAdmin:()=>t(new R().queryThunt("getCmsMenusAdminQuery",{})),getProjectCmsMenuElement:()=>t(new R().queryThunt("getCmsMenusQuery",{})),setCurrentMenuId:n=>t({type:W.SET_CURRENT_MENU,dto:n}),clean:n=>t({type:W.CLEAN_MENU_STORAGE}),upsertProjectCmsMenu:n=>t(new R().commandThunt("upsertProjectCmsMenuCommand",n)),deleteProjectCmsMenuItem:n=>t(new R().commandThunt("deleteProjectCmsMenuItemCommand",n)),upsertCmsMenuItem:n=>t(new R().commandThunt("upsertProjectCmsMenuItemCommand",n)),upsertProjectCmsMenuItemPrivilegeCommand:n=>t(new R().commandThunt("upsertProjectCmsMenuItemPrivilegeCommand",n)),deleteProjectCmsMenuItemPrivilegeCommand:n=>t(new R().commandThunt("deleteProjectCmsMenuItemPrivilegeCommand",n)),deleteProjectCmsMenu:n=>t(new R().commandThunt("deleteProjectCmsMenuCommand",n))};return{...o,upsertCmsMenuItem:async n=>{await o.upsertCmsMenuItem(n),await o.getCmsMenuAdmin()},upsertProjectCmsMenu:async n=>{await o.upsertProjectCmsMenu(n),await o.getCmsMenuAdmin()},deleteProjectCmsMenu:async n=>{await o.deleteProjectCmsMenu(n),await o.getCmsMenuAdmin()},upsertBunchCmsMenuItem:async n=>{const _=n.map(v=>o.upsertCmsMenuItem(v));await Promise.all(_),await o.getCmsMenuAdmin()},upsertProjectCmsMenuItemPrivilegeCommand:async n=>{await o.upsertProjectCmsMenuItemPrivilegeCommand(n),await o.getCmsMenuAdmin()},deleteProjectCmsMenuItem:async n=>{await o.deleteProjectCmsMenuItem(n),await o.getCmsMenuAdmin()},deleteProjectCmsMenuItemPrivilegeCommand:async n=>{await o.deleteProjectCmsMenuItemPrivilegeCommand(n),await o.getCmsMenuAdmin()}}},re=t=>t.CmsMenuAdminReducer.current_menu_id?t.CmsMenuAdminReducer.cms.find(o=>o.id==t.CmsMenuAdminReducer.current_menu_id):null,ae=t=>o=>t?o.CmsMenuAdminReducer.cms.find(n=>n.id==o.CmsMenuAdminReducer.current_menu_id).menu_items.find(n=>n.id==t):null,ie=t=>o=>t?o.CmsMenuAdminReducer.cms.find(n=>n.id==t):null;function V(){const t=Z(),{cmsMenuAdminReducer:o}=$(r=>({cmsMenuAdminReducer:r.CmsMenuAdminReducer})),[n,_]=k.useState(),[v,I]=k.useState(),f=$(re),d=$(ae(n)),M=$(ie(v)),a=k.useCallback(S(t).getCmsMenuAdmin,[t]),i=k.useCallback(S(t).deleteProjectCmsMenu,[t]),u=k.useCallback(S(t).getProjectCmsMenuElement,[t]),l=k.useCallback(S(t).setCurrentMenuId,[t]),w=k.useCallback(S(t).upsertCmsMenuItem,[t]),x=k.useCallback(S(t).upsertBunchCmsMenuItem,[t]),L=k.useCallback(S(t).deleteProjectCmsMenuItem,[t]),A=k.useCallback(S(t).upsertProjectCmsMenuItemPrivilegeCommand,[t]),h=k.useCallback(S(t).deleteProjectCmsMenuItemPrivilegeCommand,[t]),b=k.useCallback(S(t).upsertProjectCmsMenu,[t]),B=k.useCallback(S(t).clean,[t]);return{selectors:{cmsMenuAdminReducer:o,getCurrentCmsMenuReducer:f,getCmsMenuItemReducer:d,getCmsMenuReducer:M},actions:{getCmsMenuAdmin:a,getProjectCmsMenuElement:u,setCurrentMenuId:l,upsertCmsMenuItem:w,upsertBunchCmsMenuItem:x,upsertProjectCmsMenu:b,deleteProjectCmsMenu:i,deleteProjectCmsMenuItem:L,upsertProjectCmsMenuItemPrivilegeCommand:A,deleteProjectCmsMenuItemPrivilegeCommand:h,clean:B},state:{cmsMenuId:v,cmsMenuItemId:n},hooks:{setCmsMenuId:I,setCmsMenuItemId:_},functions:{}}}function ue({cmsMenuItem:t,setCmsMenuItem:o}){const n=s.useMemo(()=>K.byName("mapps-component-translate-component").component,[]),_=s.useMemo(p().Layouts.Groups.V1),v=s.useMemo(p().FormComponents.TextBox),I=s.useMemo(p().FormComponents.Checkbox),{getPlaceholder:f,getLabel:d,translate:M}=F(),[a,i]=s.useState({...t});s.useEffect(()=>{o(a)},[a]);function u(l){a.translation_id||(a.translation_id=E()),l.id||(l.id=a.translation_id),i({...a,translation:l})}return T(c,{container:!0,children:[e(c,{item:!0,xs:6,style:{display:"flex"},children:T(_,{title:"Menu Item Details",children:[e(v,{onChange:l=>{i({...a,url:l.target.value})},placeholder:M(f,"Url"),label:M(d,"Url"),value:a.url,field:"url",validation:[]}),e(v,{onChange:l=>{i({...a,icon:l.target.value})},placeholder:M(f,"Icon"),label:M(d,"Icon"),value:a.icon,field:"icon",validation:[]}),e(v,{onChange:l=>{i({...a,plugin_name:l.target.value})},placeholder:M(f,"Plugin Name"),label:M(d,"Plugin Name"),value:a.plugin_name,field:"plugin_name",validation:[]}),e(I,{label:M(d,"Active"),value:a.is_active,onChange:l=>{i({...a,is_active:l.target.checked})}}),e(I,{label:M(d,"Is Expanded (For Accordion Menu Variant)"),value:a.is_expanded,onChange:l=>{i({...a,is_expanded:l.target.checked})}})]})}),e(c,{item:!0,xs:6,style:{display:"flex"},children:e(_,{title:"Menu Item Translation",children:e(n,{translation:a.translation||{},setTranslate:u,i:!0})})})]})}function le({cmsMenuItemId:t,cmsMenuParentId:o}){const n=s.useMemo(p().ButtonLoader),_=U(),{translate:v,getLabel:I}=F(),[f,d]=s.useState(!0),[M,a]=s.useState({}),{selectors:{getCmsMenuItemReducer:i,getCurrentCmsMenuReducer:u},actions:{upsertCmsMenuItem:l},hooks:{setCmsMenuItemId:w}}=V();s.useEffect(()=>{t?w(t):(a({id:E(),sort_order:0}),d(!1))},[]),s.useEffect(()=>{i&&(a(i),d(!1))},[i]);async function x(){u&&(await l({...M,cms_menu_id:u.id,cms_menu_item_parent_id:o}),_.actions.closeDrawer())}return!f&&T(c,{container:!0,children:[e(ue,{cmsMenuItem:{...M},setCmsMenuItem:a}),e(c,{style:{marginLeft:"1rem",marginBottom:"1rem"},children:e(n,{color:"primary",onClick:x,value:v(I,"Save"),variant:"outlined"})})]})}const ce=["!","|","&","="];function me({cmsMenuItemId:t}){const o=s.useMemo(p().Layouts.Groups.V1),n=s.useMemo(p().BodyLoader),_=s.useMemo(p().ButtonLoader),v=s.useMemo(p().FormComponents.DropDownList),I=s.useMemo(p().FormComponents.TextBox),f=s.useMemo(p().FormComponents.TagComponent);U();const{translate:d,getLabel:M}=F(),[a,i]=s.useState(!0),[u,l]=s.useState({}),{selectors:{privsSelector:w}}=Y(),{selectors:{getCmsMenuItemReducer:x,getCurrentCmsMenuReducer:L},actions:{upsertCmsMenuItem:A,upsertProjectCmsMenuItemPrivilegeCommand:h,deleteProjectCmsMenuItemPrivilegeCommand:b},hooks:{setCmsMenuItemId:B}}=V();s.useEffect(()=>{t&&B(t)},[]),s.useEffect(()=>{x&&(l(x),i(!1))},[x]);function r(){const m=[],D=w.filter(y=>!m.includes(y.id));return[{id:"",value:""},...D].map(y=>({id:y.id,value:y.privilege||y.value}))}function C(m){const D=m.currentTarget.dataset.key;i(!0),b({id:D}).then(y=>{i(!1)})}function g(m){i(!0),h({id:E(),status:1,privilege_id:m.target.value,cms_menu_item_id:t}).then(D=>{i(!1)})}function j(m,D){if(m.split(" ").filter(y=>!y.startsWith("#")).length+1!=m.split(" ").filter(y=>y.startsWith("#")).length)return!1;{const y=m.split(" ").filter(N=>N.startsWith("#$")).map(N=>N.replace(/#/g,"").replace("$",""));return y.filter(N=>D.map(Q=>Q.privileges.privilege_details.name.trim()).includes(N)).length==y.length}}function P(){i(!0),A(u).then(m=>{i(!1)})}try{return u&&!a?T(c,{container:!0,style:{display:"flex"},children:[e(o,{title:"Menu Item Details",children:e(I,{disabled:!0,label:d(M,"Url"),value:u.url,field:"value",validation:[]})}),T(o,{title:"Allowed Privileges",children:[e(v,{label:"Privileges",valueOptions:r(),value:"",onChange:g,field:"type",validation:[]}),u.menu_item_privileges.map((m,D)=>e(J,{"data-key":m.id,onClick:C,label:m.privileges.privilege_details.name.trim()},m.id))]}),T(o,{title:"Function",style:{display:"flex",width:"100%"},children:[e(c,{xs:12,children:e(f,{notUniq:!0,disabled:!0,tags:u.func?u.func.split(" ").map(m=>({id:E(),value:E(),label:m})):[],noLabel:!0,onChange:m=>{const D=m.map(y=>y.label).join(" ");l({...u,func:D})},suggestions:[...ce.map(m=>({value:m,label:m,type:"OPERATOR"})),,...u.menu_item_privileges.map(m=>({id:E(),value:E(),label:`#$${m.privileges.privilege_details.name.trim()}#`,type:"PRIV"}))]})}),e(c,{xs:12,style:{marginLeft:"1rem",marginBottom:"1rem",marginTop:"1rem"},children:u.func?e(c,{style:{color:j(u.func,u.menu_item_privileges)?"green":"red"},children:u.func}):e(O,{})}),e(c,{xs:12,style:{marginLeft:"1rem",marginBottom:"1rem",marginTop:"1rem"},children:e(_,{color:"primary",onClick:P,value:d(M,"Save Func"),variant:"outlined"})})]})]}):e(c,{style:{height:"400px",display:"flex",width:"100%"},children:e(n,{text:" ",size:"25px"})})}catch(m){return console.log(m),e(O,{})}}function de({node:t}){const o=s.useMemo(p().ButtonLoader);return t?e(O,{children:e(o,{className:t.isActive==!0?"selected":"",variant:"clean",size:"small",value:e(c,{style:{display:"flex",flexDirection:"column"},children:e(c,{children:String(t.translation?t.translation.name:t.url).toUpperCase()})}),startIcon:t.icon?G[t.icon]?G[t.icon].render():e("img",{style:{maxWidth:20,maxHeight:20,width:20},src:window.env.BLOB_URL+"/blob/"+t.icon},t.id):e(c,{style:{maxWidth:20,maxHeight:20,width:20}})},t.id)}):e(O,{})}function Ce(){const t=s.useMemo(p().ConfirmationDialog),[o,n]=s.useState([{title:"_ROOT",category:"_ROOT",children:[{title:"index.js",category:" "}]}]);s.useState(""),s.useState(!0),s.useMemo(p().Layouts.Table.V2);const _=s.useMemo(p().Layouts.Sections.V1),v=s.useMemo(p().Layouts.Groups.V1),I=s.useMemo(p().ButtonLoader),{actions:f}=U(),d=q(),{translate:M,getLabel:a}=F(),{selectors:{getCurrentCmsMenuReducer:i},actions:{getCmsMenuAdmin:u,upsertCmsMenuItem:l,upsertBunchCmsMenuItem:w,deleteProjectCmsMenuItem:x}}=V();s.useEffect(()=>{window.__isReactDndBackendSetUp&&(window.__isReactDndBackendSetUp=!1)},[]),s.useEffect(()=>{i&&L()},[i]);function L(){const r=i.menu_items.sort((g,j)=>g.sort_order>j.sort_order?1:-1).map(g=>({...g,treeIndex:g.sort_order,expanded:!0})),C=A([...r.map(g=>({...g}))]);n([...C.map(g=>({...g}))])}function A(r){const C={};let g;const j=[];let P;for(P=0;P<r.length;P+=1)C[r[P].id]=P,r[P].children=[];for(P=0;P<r.length;P+=1)try{g=r[P],g.cms_menu_item_parent_id!==null?r[C[g.cms_menu_item_parent_id]].children.push(g):j.push(g)}catch{}return j}function h(r,C,g){f.openDrawer(!0,e(c,{style:{width:"50vw",display:"flex"},children:e(le,{cmsMenuParentId:C,cmsMenuItemId:g})}),"right")}function b(r,C){f.openDrawer(!0,e(c,{style:{width:"50vw",display:"flex"},children:e(me,{cmsMenuItemId:C})}),"right")}function B(r,C){d.actions.openDialog(!0,e(t,{title:"Delete Menu Item",description:"Do you want to delete asdasdasd menu item?",onConfirm:async()=>{d.actions.closeDialog(),await x({id:C})}}))}return i?T(_,{title:i.token,children:[e(c,{children:e(I,{color:"primary",onClick:h,value:M(a,"Create"),startIcon:e(H,{}),variant:"outlined"})}),e(v,{title:"Category Tree",children:e(c,{style:{display:"block",width:"100%",height:"100%"},children:e(se,{rowHeight:55,style:{height:"800px"},treeData:o,onChange:r=>{n([...r])},canDrag:r=>!0,onMoveNode:async r=>{let C=[];return r.nextParentNode?C=r.nextParentNode.children.map((j,P)=>({...j,sort_order:P,title:void 0,children:[],cms_menu_item_parent_id:r.nextParentNode.id})):C=r.treeData.map((g,j)=>({...g,sort_order:j,children:[],title:void 0,cms_menu_item_parent_id:null})),await w(C),r},generateNodeProps:r=>(r.node.title=e(c,{style:{paddingLeft:20},children:e(de,{node:{...r.node}})}),r.buttons=[],r.buttons.push(e(z,{size:"small",onClick:C=>h(C,r.node.id),children:e(H,{})})),r.buttons.push(e(z,{size:"small",onClick:C=>h(C,r.node.cms_menu_item_parent_id,r.node.id),children:e(X,{})})),r.buttons.push(e(z,{size:"small",onClick:C=>B(C,r.node.id),children:e(ee,{})})),r.buttons.push(e(z,{size:"small",onClick:C=>b(C,r.node.id),children:e(te,{})})),r),onlyExpandSearchedNodes:!0})})})]}):e(O,{})}function pe({cmsMenuId:t}){const o=s.useMemo(p().Layouts.Groups.V1),n=s.useMemo(p().FormComponents.TextBox),_=s.useMemo(p().FormComponents.Checkbox),v=s.useMemo(p().ButtonLoader),I=U(),{translate:f,getLabel:d,getPlaceholder:M}=F(),[a,i]=s.useState(!0),[u,l]=s.useState({}),{selectors:{getCmsMenuReducer:w},actions:{upsertProjectCmsMenu:x},hooks:{setCmsMenuId:L}}=V();s.useEffect(()=>{t?L(t):(l({id:E(),sort_order:0}),i(!1))},[]),s.useEffect(()=>{w&&(l(w),i(!1))},[w]);async function A(){await x({...u}),I.actions.closeDrawer()}return!a&&T(c,{container:!0,children:[e(c,{item:!0,xs:12,style:{display:"flex"},children:T(o,{title:"Menu Details",children:[e(n,{onChange:h=>{l({...u,token:h.target.value})},placeholder:f(M,"Menu token"),label:f(d,"Menu token"),value:u.token,field:"menu-token",validation:[]}),e(_,{label:f(d,"Load on init"),value:u.load_on_init,onChange:h=>{l({...u,load_on_init:h.target.checked})}}),e(_,{label:f(d,"Active"),value:u.is_active,onChange:h=>{l({...u,is_active:h.target.checked})}})]})}),e(c,{style:{marginLeft:"1rem",marginBottom:"1rem"},children:e(v,{color:"primary",onClick:A,value:f(d,"Save"),variant:"outlined"})})]})}function ve(){const t=s.useMemo(p().ConfirmationDialog),[o,n]=s.useState(!0),_=s.useMemo(p().Layouts.Table.V2),v=s.useMemo(p().Layouts.Containers.V1),I=s.useMemo(p().ButtonLoader),{actions:f}=U(),d=q(),{translate:M,getLabel:a}=F(),{selectors:{cmsMenuAdminReducer:i},actions:{getCmsMenuAdmin:u,setCurrentMenuId:l,deleteProjectCmsMenu:w,clean:x}}=V();s.useEffect(()=>(n(!0),Promise.all([u()]).then(h=>{n(!1)}),x),[]);function L(h,b){f.openDrawer(!0,e(c,{style:{width:"50vw",display:"flex"},children:e(pe,{cmsMenuId:b&&b.id})}),"right")}function A(h,b){d.actions.openDialog(!0,e(t,{title:"Delete CMS Menu",description:`Do you want to delete ${b.token} menu?`,onConfirm:async()=>{d.actions.closeDialog(),n(!0),await w(b),n(!1)}}))}return e(c,{container:!0,style:{justifyContent:"center"},children:e(v,{title:"CMS Menus",icon:e(ne,{}),xs:12,sm:12,children:T(c,{container:!0,style:{justifyContent:"center"},children:[e(c,{item:!0,xs:6,children:e(_,{freeActions:[e(I,{size:"small",value:M(a,"Create"),variant:"outlined",onClick:L,startIcon:e(H,{})},1)],onRowSelectionChange:h=>{const b=Object.keys(h).map(B=>B);l(b[0])},isLoading:o,title:"Manage CMS Menus",actions:[h=>({icon:G.Edit,label:"Edit",onClick:L}),h=>({icon:G.Delete,label:"Delete",onClick:A})],pageSize:20,...oe({}),data:i.cms||[]})}),e(c,{item:!0,container:!0,xs:6,children:e(Ce,{})})]})})})}export{ve as default};
