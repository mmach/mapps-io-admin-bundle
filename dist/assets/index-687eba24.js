import{j as t,cU as q,cV as Y,r as T,cW as O,cY as D,cX as k,ep as $,R as n,M as I,m as W,u as U,g as v,G as u,eq as Q,T as R,er as X,v as P,es as H}from"./index-b2bea69e.js";function M({blob:e,row:s,params:o={}}){return(s||e).id&&t("img",{className:"img-preview-admin",src:`${window.env.BLOB_URL}/blob/${(e||s)[o.size]}`})}const V=({type:e})=>({columns:[{titleToken:"CREATED AT",field:"createdAt",type:"date",isActive:!0},{titleToken:"ID",field:"blob_id",isActive:!0},{titleToken:"ITEM",field:"item_id",isActive:e=="ITEMS"},{titleToken:"USER",field:"user_id",isActive:e=="USERS"},{titleToken:"CATEGORY",field:"category_id",isActive:e=="CATEGORIES"},{titleToken:"PREVIEW",type:"component",field:"title",isActive:!0,enableColumnFilter:!1,enableSorting:!1,component:{Component:M,params:{size:"blob_thumbmail_id"}}}],enableMultiRowSelection:!1,enableRowSelection:!0}),S=e=>({...{getUnverifiedImages:()=>e(new O().queryThunt(D.Blob.GET_UNVERIFIED,{})),removeImage:o=>e(new O().commandThunt(k.Blob.REMOVE_BLOB,o)),verifyFile:({id:o})=>e(new O().commandThunt(k.Blob.VERIFY_IMAGE,{id:o})),getProjectStorage:o=>e(new O().queryThunt(D.Blob.GET_PROJECT_STORAGE,o)),uploadBlob:o=>e(new O().commandThunt(k.Blob.UPLOAD_BLOB_TO_PROJECT,o)),clean:()=>e({type:$.CLEAN,dto:{}})}});function j(){const e=q(),{storageAdminReducer:s}=Y(E=>({storageAdminReducer:E.StorageAdminReducer})),o=T.useCallback(S(e).getUnverifiedImages,[e]),i=T.useCallback(S(e).removeImage,[e]),C=T.useCallback(S(e).verifyFile,[e]),a=T.useCallback(S(e).getProjectStorage,[e]),d=T.useCallback(S(e).uploadBlob,[e]),m=T.useCallback(S(e).clean,[e]);return{selectors:{storageAdminReducer:s},actions:{getUnverifiedImages:o,removeImage:i,verifyFile:C,getProjectStorage:a,uploadBlob:d,clean:m},state:{},hooks:{},functions:{}}}function B({type:e}){const s=n.useMemo(I().Layouts.Table.V2,[]),o=n.useMemo(I().Layouts.Sections.V1,[]),i=n.useMemo(()=>W.byName("mapps-component-icon-button").component),[C,a]=n.useState(!1),{getLabel:d,translate:m}=U(),[E,y]=n.useState([]),[L,w]=n.useState({}),{selectors:{storageAdminReducer:l},actions:{clean:c,getProjectStorage:p,removeImage:_,verifyFile:Z,uploadBlob:x}}=j();n.useEffect(()=>(p({type:e}),c),[]);function G(r,b){_({...b})}function z(r){const b=[];if(r.length!=0)for(let f=0;f<r.length;f++){const g=r[f],A=new FileReader;A.readAsDataURL(g),A.onload=()=>{const N={id:P(),name:g.name,type:g.type,size:Math.round(g.size/1e3)+" kB",blob:A.result,file:g};b.push(N);const J=b.map(F=>{const h={};return h.id=P(),h.blob=A.result.split("base64,")[1],h.type=F.type,x(h)});Promise.all(J).then(F=>{p({type:e})})}}}return v(u,{container:!0,children:[v(u,{item:!0,xs:8,children:[t(Q,{filesLimit:1,dropzoneText:m(d,"Upload Image"),acceptedFiles:["image/jpeg","image/png","image/bmp"],maxFileSize:25e5,useChipsForPreview:!1,showPreviewsInDropzone:!1,open:C,showAlerts:["error"],onChange:r=>{y(r)},onClose:()=>{a(!1),y([])},onSave:()=>{z(E),a(!1),y([])},previewText:["error","info","success"],showPreviews:!0,cancelButtonText:m(d,"CANCEL_BUTTON"),submitButtonText:m(d,"SUBMIT_BUTTON")}),t(s,{isLoading:l.getImagesIsLoading,icons:R,freeActions:[e=="PROJECT"&&t(i,{onClick:()=>a(!0),children:t(X,{style:{fontSize:40}})})],actions:[r=>({icon:R.Delete,label:"Remove Image",onClick:G})],...V({type:e}),onRowSelectionChange:r=>{const b=Object.keys(r).map(f=>f);if(b.length>0){const f=l.files.find(g=>g.id==b[0]);w(f)}},data:l.files,title:"Files"})]}),t(u,{container:!0,item:!0,xs:4,style:{justifyContent:"center"},children:t(o,{title:"Preview File",children:t(M,{blob:L,params:{size:"blob_id"}})})})]})}function K(e){const s=n.useMemo(I().Layouts.Table.V2,[]),o=n.useMemo(I().Layouts.Sections.V1,[]),[i,C]=n.useState({}),{selectors:{storageAdminReducer:a},actions:{clean:d,getUnverifiedImages:m,removeImage:E,verifyFile:y}}=j();n.useEffect(()=>(m(),d),[]);function L(l,c){E({...c})}const w=(l,c)=>{y({...c})};return v(u,{container:!0,children:[t(u,{item:!0,xs:8,children:t(s,{isLoading:a.getImagesIsLoading,icons:R,actions:[l=>({icon:R.Check,label:"Verify Image",onClick:w}),l=>({icon:R.Delete,label:"Remove Image",onClick:L})],...V({}),onRowSelectionChange:l=>{const c=Object.keys(l).map(p=>p);if(c.length>0){const p=a.files.find(_=>_.id==c[0]);C(p)}},data:a.files,title:"To Verify Files"})}),t(u,{container:!0,item:!0,xs:4,style:{justifyContent:"center"},children:t(o,{title:"Preview File",children:t(M,{blob:i,params:{size:"blob_id"}})})})]})}function te(){const e=n.useMemo(I().Layouts.Containers.V1),s=n.useMemo(I().Layouts.Tab.V1),{translate:o,getLabel:i}=U();return v(u,{container:!0,style:{justifyContent:"center"},children:[v(e,{title:"TODOOOO",xs:12,sm:12,children:["TODOOOOOOs",v(u,{children:["Edit File,",t("br",{}),"Save TAG/LABEL for file,",t("br",{}),"Save extension,",t("br",{}),"Insted of image show icon if pdf",t("br",{}),"FLAG - AUTO GENERATED"]})]}),t(e,{title:"Storage",icon:t(H,{}),xs:12,sm:12,children:t(s,{defaultTab:0,tabConfig:[{label:o(i,"To Verify"),render:()=>t(K,{},1)},{label:o(i,"Categories"),render:()=>t(B,{type:"CATEGORIES"},2)},{label:o(i,"Users"),render:()=>t(B,{type:"USERS"},3)},{label:o(i,"Items"),render:()=>t(B,{type:"ITEMS"},4)},{label:o(i,"Project"),render:()=>t(B,{type:"PROJECT"},5)}]})})]})}export{te as default};
