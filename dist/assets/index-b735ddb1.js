import{R as a,M as o,u as S,d1 as G,g as y,G as u,j as t,d2 as w,v as c,F as M,cZ as V}from"./index-b4b9f8f0.js";import{u as B}from"./hook-a0c7779d.js";const j=["!","|","&","="];function U({cmsPageId:m}){const g=a.useMemo(o().Layouts.Groups.V1),C=a.useMemo(o().BodyLoader),P=a.useMemo(o().ButtonLoader),x=a.useMemo(o().FormComponents.DropDownList),n=a.useMemo(o().FormComponents.TextBox),L=a.useMemo(o().FormComponents.TagComponent),[i,f]=a.useState({}),{selectors:{getCmsPageIdReducer:p},actions:{grantPrivs:b,revokePrivs:v,upsertCmsPage:_},hooks:{setCmsPageId:F}}=B(),{translate:r,getLabel:T}=S(),{selectors:{privsSelector:k,actionsSelector:q}}=G(),[R,d]=a.useState(!1);a.useEffect(()=>{m&&F(m)},[]),a.useEffect(()=>{p&&(console.log(p),f(p),d(!1))},[p]);function E(){d(!0),_(i).then(e=>{d(!1)})}function D(){const e=i==null?void 0:i.page_privileges.map(s=>s.privileges.id),l=k.filter(s=>!e.includes(s.id));return[{id:"",value:""},...l].map(s=>({id:s.id,value:s.privilege||s.value}))}function I(e){const l=e.currentTarget.dataset.key;d(!0),v({id:l}).then(s=>{d(!1)})}function $(e){d(!0),b({id:c(),status:1,privilege_id:e.target.value,cms_page_id:i.id}).then(l=>{d(!1)})}function O(e,l){if(e.split(" ").filter(s=>!s.startsWith("#")).length+1!=e.split(" ").filter(s=>s.startsWith("#")).length)return!1;{const s=e.split(" ").filter(h=>h.startsWith("#$")).map(h=>h.replace(/#/g,"").replace("$",""));return s.filter(h=>l.map(A=>A.privileges.privilege_details.name.trim()).includes(h)).length==s.length}}try{return i&&!R?y(u,{container:!0,style:{display:"flex"},children:[t(g,{title:"Cms Page Title",children:t(n,{disabled:!0,label:r(T,"Title"),value:i.title,field:"value",validation:[]})}),y(g,{title:"Allowed Privileges",children:[t(x,{label:"Privileges",valueOptions:D(),value:"",onChange:$,field:"type",validation:[]}),i.page_privileges.map((e,l)=>t(w,{"data-key":e.id,onClick:I,label:e.privileges.privilege_details.name.trim()},e.id))]}),y(g,{title:"Function",style:{display:"flex",width:"100%"},children:[t(u,{xs:12,children:t(L,{notUniq:!0,disabled:!0,tags:i.func?i.func.split(" ").map(e=>({id:c(),value:c(),label:e})):[],noLabel:!0,onChange:e=>{const l=e.map(s=>s.label).join(" ");f({...i,func:l})},suggestions:[...j.map(e=>({value:e,label:e,type:"OPERATOR"})),,...i.page_privileges.map(e=>({id:c(),value:c(),label:`#$${e.privileges.privilege_details.name.trim()}#`,type:"PRIV"}))]})}),t(u,{xs:12,style:{marginLeft:"1rem",marginBottom:"1rem",marginTop:"1rem"},children:i.func?t(u,{style:{color:O(i.func,i.page_privileges)?"green":"red"},children:i.func}):t(M,{})}),t(u,{xs:12,style:{marginLeft:"1rem",marginBottom:"1rem",marginTop:"1rem"},children:t(P,{color:"primary",onClick:E,value:r(T,"Save Func"),variant:"outlined"})})]})]}):t(u,{style:{height:"400px",display:"flex",width:"100%"},children:t(C,{text:" ",size:"25px"})})}catch(e){return console.log(e),t(M,{})}}const W=["!","|","&","="];function J(m){const g=a.useMemo(o().Layouts.Groups.V1),C=a.useMemo(o().ButtonLoader),P=a.useMemo(o().FormComponents.TagComponent),{actions:x}=V(),[n,L]=a.useState({}),[i,f]=a.useState(!1),{translate:p,getLabel:b}=S(),{selectors:{getCmsPageIdReducer:v},actions:{},hooks:{setCmsPageId:_}}=B();a.useEffect(()=>{m.id&&_(m.id)},[]),a.useEffect(()=>{f(!0),v&&(L(v),f(!1))},[v]);function F(){x.openDrawer(!0,t(u,{style:{width:"50vw",display:"flex"},children:t(U,{cmsPageId:n.id})}),"right")}try{return n&&n.page_privileges&&y(u,{container:!0,style:{display:"flex"},children:[t(g,{title:"Allowed Privileges",children:n.page_privileges.map(r=>t(w,{"data-key":r.id,label:r.privileges.privilege_details.name.trim()},r.id))}),t(g,{title:"Function",style:{display:"flex",width:"100%"},children:t(P,{notUniq:!0,disabled:!0,tags:n.func?n.func.split(" ").map(r=>({id:c(),value:c(),label:r})):[],noLabel:!0,suggestions:[...W.map(r=>({value:r,label:r,type:"OPERATOR"})),,...n.page_privileges.map(r=>({id:c(),value:c(),label:`#$${r.privileges.privilege_details.name.trim()}#`,type:"PRIV"}))]})}),t(u,{style:{marginLeft:"1rem",marginBottom:"1rem"},children:t(C,{color:"primary",onClick:F,value:p(b,"Edit Privileges"),variant:"outlined"})})]})}catch(r){return console.log(r),t(M,{})}}export{J as CmsPagePrivileges};
